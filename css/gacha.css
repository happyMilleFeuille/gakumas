/* gacha.css - Gacha Main UI Styles */

.gacha-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-top: 1.5rem; 
    gap: 1.5rem;
    text-align: center;
    height: 85%;
    min-height: 500px;
    position: relative;
    overflow: hidden !important; /* 넘쳐도 스크롤 숨김 */
}

/* 가챠 화면일 때 메인 컨테이너 스크롤 차단 */
#idol:has(.gacha-container) {
    overflow: hidden !important;
}

/* 상단 컨트롤러 (음소거, 뒤로가기) */
.gacha-header-controls {
    position: absolute;
    top: 48px;
    left: 10px;
    z-index: 150;
}

@media (max-width: 768px) {
    .gacha-header-controls {
        top: 30px;
        left: 5px;
    }
}

.mute-toggle-btn {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid #ddd;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    font-size: 1rem;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: all 0.2s;
}
.mute-toggle-btn:hover { background: #fff; transform: scale(1.1); }

.back-btn {
    background: #333;
    color: #fff;
    border: none;
    border-radius: 20px;
    padding: 8px 20px;
    font-size: 0.9rem;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transition: all 0.2s;
}
.back-btn:hover { background: #000; }
.back-btn.hidden { display: none; }

/* 상단 컨트롤 (콤보박스 등) */
.gacha-controls-top {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 50px;
    margin-bottom: 40px;
    order: 0;
    perspective: none;
    transform-style: flat;
}

/* 가챠 버튼 */
.gacha-buttons { 
    display: flex; 
    column-gap: 1.5rem;
    row-gap: 4px;
    justify-content: center; 
    flex-wrap: wrap; 
    position: absolute;
    bottom: 0px;
    left: 0;
    right: 0;
    padding: 1rem 0;
    z-index: 10;
    opacity: 1;
    transition: opacity 0.15s ease-in-out;
}

.gacha-buttons.loading-shift { opacity: 0 !important; }

/* 메인 탭일 때 순서 */
.gacha-buttons.view-main .gacha-controls-top { order: 0; }
.gacha-buttons.view-main .gacha-btn { order: 1; }
.gacha-buttons.view-main .total-pulls-box { order: 2; margin-top: 10px; }

/* 결과 화면일 때 순서 */
.gacha-buttons.view-result .gacha-controls-top { order: 0; }
.gacha-buttons.view-result .total-pulls-box { order: 1; margin-bottom: 10px; }
.gacha-buttons.view-result .gacha-btn { order: 2; }

.gacha-btn { 
    min-width: 150px; 
    transition: transform 0.1s ease;
}

.gacha-btn:active:not(:disabled) {
    transform: scale(0.96);
}

/* 누적 가챠 횟수 박스 & 초기화 버튼 */
.total-pulls-box {
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 12px;
    margin-bottom: 2px;
    color: #fff;
    font-size: 0.9rem;
    font-weight: bold;
}

#total-pull-count {
    background: rgba(0, 0, 0, 0.6);
    padding: 2px 15px;
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    min-width: 160px;
    text-align: center;
    font-size: 0.85rem;
    white-space: pre;
}

/* 메인 탭일 때 교환pt 너비 축소 */
.view-main #total-pull-count { min-width: 120px; }

#btn-gacha-reset {
    position: static;
    padding: 2px 10px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    border-radius: 15px;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: none;
}
#btn-gacha-reset:hover {
    background: rgba(0, 0, 0, 0.8);
    transform: scale(1.05);
}

/* 쥬얼 표시 UI (상단 우측 고정) */
.jewel-container {
    position: absolute;
    top: 10px; right: 10px;
    z-index: 200;
    display: flex;
    align-items: center;
    gap: 8px;
}

.jewel-box {
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    padding: 4px 10px;
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 4px;
    width: 120px;
    font-size: 0.9rem;
    font-weight: bold;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

#jewel-count { text-align: right; margin: 0; }

.add-jewel-btn {
    background: none; color: #fff; border: none;
    border-radius: 50%; width: 20px; height: 20px;
    font-size: 1.2rem; line-height: 1;
    cursor: pointer;
    display: flex; justify-content: center; align-items: center;
    font-weight: bold;
    transition: transform 0.1s, opacity 0.1s;
}
.add-jewel-btn:hover { opacity: 0.8; }
.add-jewel-btn:active { transform: scale(0.9); }

/* 가챠 타입 셀렉터 (독립 원형 버튼 스타일) */
.type-nav-btn.circle-btn {
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
    width: 80px; height: 80px;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    transform: translateY(20px);
    will-change: transform, width, opacity;
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
}
.type-nav-btn.circle-btn:hover, .type-nav-btn.circle-btn:active { transform: translateY(20px); }

.capsule-container {
    display: flex; flex-direction: column; align-items: center; gap: 12px;
}

.gacha-type-indicator { display: flex; gap: 8px; }

.gacha-type-indicator .dot {
    width: 6px; height: 6px;
    background: rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    transition: all 0.2s;
}
.gacha-type-indicator .dot.active {
    background: #fff;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
    transform: scale(1.2);
}

.current-type-display.capsule-box span, .type-nav-btn.circle-btn span {
    display: flex; align-items: center; justify-content: center;
    width: 100%; height: 100%;
    pointer-events: none;
}

.current-type-display.capsule-box {
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50px;
    min-width: 240px; height: 100px;
    line-height: 100px;
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
    user-select: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    overflow: hidden;
    position: relative;
    --base-trans: translateY(0);
}

/* 텍스트 슬라이드 애니메이션 */
.slide-out-left span { animation: textOutLeft 0.1s ease-in forwards; }
.slide-in-right span { animation: textInRight 0.1s ease-out forwards; }
.slide-out-right span { animation: textOutRight 0.1s ease-in forwards; }
.slide-in-left span { animation: textInLeft 0.1s ease-out forwards; }

@keyframes textOutLeft { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(-40px); } }
@keyframes textInRight { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: translateX(0); } }
@keyframes textOutRight { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(40px); } }
@keyframes textInLeft { from { opacity: 0; transform: translateX(-40px); } to { opacity: 1; transform: translateX(0); } }

/* Spinner */
.spinner {
    border: 5px solid #f3f3f3;
    border-top: 5px solid var(--primary-color);
    border-radius: 50%;
    width: 50px; height: 50px;
    animation: spin 1s linear infinite;
    display: none;
    margin: 20px auto;
}
.spinner.active { display: block; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Immersive Mode */
body.immersive-mode .button-group.horizontal,
body.immersive-mode #gacha-fixed-buttons,
body.immersive-mode #fixed-bg, 
body.immersive-mode header,
body.immersive-mode footer {
    display: none !important;
}
body.immersive-mode { background-color: #000 !important; overflow: hidden; }

/* Mobile Media Queries */
@media (max-width: 768px) {
    .gacha-container {
        padding-top: 0 !important; 
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important; 
        height: 90% !important;
        min-height: 45vh !important;
        width: 100% !important;
    }
    .gacha-buttons { gap: 10px; bottom: 5px; }
    .gacha-btn { min-width: 110px; padding: 0.6rem 0.8rem; font-size: 0.85rem; }
    .mute-toggle-btn { width: 30px; height: 30px; font-size: 0.9rem; }
    
    .jewel-container { top: 5px; right: 5px; }
    .jewel-box { width: 100px; padding: 3px 8px; font-size: 0.75rem; gap: 2px; }
    .add-jewel-btn { width: 16px; height: 16px; font-size: 0.8rem; }
    #total-pull-count { min-width: 130px; font-size: 0.75rem; }
    #btn-gacha-reset { padding: 1px 6px; font-size: 0.6rem; }
    
    .gacha-controls-top { gap: 10px; margin-bottom: 25px; }
    .type-nav-btn.circle-btn { 
        width: 45px; height: 45px; font-size: 0.8rem; 
        transform: translateY(20px); 
    }
    .type-nav-btn.circle-btn:hover, .type-nav-btn.circle-btn:active { transform: translateY(20px); }
    .current-type-display.capsule-box { min-width: 130px; height: 60px; line-height: 60px; font-size: 1.1rem; }
}